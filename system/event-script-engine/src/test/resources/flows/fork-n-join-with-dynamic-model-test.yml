flow:
  id: 'fork-n-join-with-dynamic-model-test'
  description: 'Test fork-n-join flow'
  ttl: 500000s

first.task: 'my.first.task'

tasks:
  - name: 'my.first.task'
    input:
      - 'input.path_parameter.user -> user'
      - 'input.query.seq -> sequence'
      - 'int(1) -> model.intList[]'
      - 'int(2) -> model.intList[]'
      - 'int(3) -> model.intList[]'
    process: 'sequential.one'
    output:
      - 'result -> model.pojo'
    description: 'Pass a pojo to another task'
    execution: fork
    source: 'model.intList'
    next:
      - 'echo.me'
    join: 'join.task'

  - name: 'echo.me'
    input:
      - 'text(hello-world-one) -> key1'
      - 'text(hello-world-two) -> key2'
      - 'model.intList.current-item -> current-item'
      - 'model.intList.current-index -> current-index'
      - 'model.key:uuid -> uuid'
    process: 'no.op'
    output:
      - 'result.key1 -> model.key1'
      - 'result.key2 -> model.key2'
      - 'result.current-item -> model.returnIntList[]'
    description: 'Hello world'
    execution: sink

  #
  # the "*" pojo mapping entry must be the first one in the input mapping
  # so that the subsequent update to the pojo is possible.
  #
  - name: 'join.task'
    input:
      - 'model.pojo -> *'
      - 'model.key1 -> key1'
      - 'model.key2 -> key2'
      - 'model.returnIntList -> list1'
    process: 'no.op'
    output:
      - 'text(application/json) -> output.header.content-type'
      - 'result -> output.body'
    description: 'Return result'
    execution: end
