flow:
  id: 'header-and-json-path-test'
  description: 'Test input data mapping of headers'
  ttl: 10s

first.task: 'no.op'

#
# JSON-Path "$.input.body.hello" is actually the same as "input.body.hello"
# The basic retrieval method using "input.body.hello" is more efficient than JSON-Path
# It is here for testing JSON-Path feature only.
#
# You should only use JSON-Path for more complex use cases.
#
# The plugin "listOfMap()" is used to Convert map of lists to list of maps where
# the map of lists may be generated by a JSON-Path wildcard search.
#
# Please see examples in the JavaDoc in the ListOfMap plugin class and the headerAndJsonPathTest in FlowTests.
#
tasks:
  - input:
      # this pass all input headers as an input map
      - 'input.header -> *'
      - '$.input.body.hello -> body'
    process: 'no.op'
    output:
      - 'text(application/json) -> output.header.content-type'
      - 'result -> output.body'
      # the following two JSON-Path searches would generate a map of lists
      - '$.input.body.list[*].world -> model.list.world'
      - '$.input.body.list[*].test -> model.list.test'
      - 'model.list -> output.body.list'
      # the listOfMap plugin restores the original data structure for easy processing by another user function
      - 'f:listOfMap(model.list) -> output.body.normalized'
    description: 'Return result'
    execution: end
